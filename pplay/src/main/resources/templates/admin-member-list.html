<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/style.css" />

<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>用户管理</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 用户中心 <span class="c-gray en">&gt;</span> 用户管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
	<div class="text-c"> 
<!-- 	 <form id="searchForm" method="post" th:method="post" th:action="@{/user/searchAllUser}">
 -->	        姓名 ：
		<input type="text" class="input-text" style="width:100px;height:20px" placeholder="输入姓名" id="s-username" name="s-username">
	        性别 ：
		<select class="select-box" style="width:50px" id="s-gender" name="s-gender">
			<option selected="selected"    value=''></option> 
			<option value="1">男</option>
			<option value="0">女</option>
		</select>
	        职位 ：
		<select class="select-box" style="width:50px" id="s-position" name="s-position">
			<option selected="selected"    value=''></option> 
			<option value="editor">编辑</option>
			<option value="writer">编剧</option>
		</select>	       
		 <!-- 日期范围：
		<input type="text" onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'datemax\')||\'%y-%M-%d\'}' })" id="datemin" class="input-text Wdate" style="width:120px;">
		-
		<input type="text" onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'datemin\')}',maxDate:'%y-%M-%d' })" id="datemax" class="input-text Wdate" style="width:120px;"> -->
		<button type="submit" class="btn btn-success radius" style="float:right" id="search" name="search"><i class="Hui-iconfont">&#xe665;</i> 搜用户</button>
	<!-- </form> -->
	</div>
	<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> <a href="javascript:;" onclick="member_add('添加用户','member-add.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加用户</a></span> <span class="r">共有数据：<strong>88</strong> 条</span> </div>
	<div class="mt-20">
	<table class="table table-border table-bordered radius table-hover table-bg table-sort">
		<thead>
			<tr class="text-c">
				<th width="80">ID</th>
				<th width="100">真实性名</th>
				<th width="40">性别</th>
				<th width="40">职位</th>
				<th width="150">邮箱</th>
				<th width="90">联系方式</th>
				<th width="">最后登录时间</th>
				<th width="70">状态</th>
				<th width="100">操作</th>
			</tr>
		</thead>
		<tbody id="tablebody">
		
				<tr  th:each="user,userStat : ${sysuserlist}">
				<td><input type="checkbox" value="1" name=""></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				<td th:text="${user.uid}"></td>
				
				
				<!-- <td><u style="cursor:pointer" class="text-primary" onclick="member_show('张三','member-show.html','10001','360','400')">张三</u></td>
				<td>男</td>
				<td>13000000000</td>
				<td>admin@mail.com</td>
				<td class="text-l">北京市 海淀区</td>
				<td>2014-6-11 11:11:42</td>
				<td class="td-status"><span class="label label-success radius">已启用</span></td>
				<td class="td-manage"><a style="text-decoration:none" onClick="member_stop(this,'10001')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> <a title="编辑" href="javascript:;" onclick="member_edit('编辑','member-add.html','4','','510')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a> <a style="text-decoration:none" class="ml-5" onClick="change_password('修改密码','change-password.html','10001','600','270')" href="javascript:;" title="修改密码"><i class="Hui-iconfont">&#xe63f;</i></a> <a title="删除" href="javascript:;" onclick="member_del(this,'1')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a></td> -->
			</tr>	
    	</tbody>
	</table>
	</div>
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/My97DatePicker/4.8/WdatePicker.js"></script> 
<script type="text/javascript" src="/lib/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script type="text/javascript" src="/lib/laypage/1.2/laypage.js"></script>
<script  th:inline="javascript">
$(function(){	
	table = $('.table-sort').dataTable({
		"bStateSave": false,//状态保存
		"bServerSide" : true, //是否启动服务器端数据导入  
		"bFilter": false, //去掉默认自带的搜索框
		"aLengthMenu" : [20, 40, 60],//每页显示行数
		"sAjaxSource" : "/user/searchAllUser",//请求后台的url
		/**
		 * fnServerParams函数：
		 * 顾名思义，就是请求后台的参数设置
		 * 大家可以在开发的时候可以用console.log(JSON.stringify(aoData))
		 * 查看下参数结构，我们可以将自己页面的查询条件放入aoData中，如例子所示
		 */
		"fnServerParams" : function(aoData) {
	         aoData.push({
	             "name" : "qsr",
	             "value" : {
	            	 "name" :  $("#s-username").val(),
	                 "gender" : $("#s-gender").val(),
	                 "roleName" :  $("#s-position").val() 
	             }
	         });
	     },  
	    /**
	     * aoColumns 对应于表头和属性赋值等
	     * "mData" :  对应的属性名
	     * "bSortable" : 是否需要排序，默认是true(就是每列表头上的的上、下两个箭头)
	     * "sTitle" : 列名
	     * "sDefaultContent" : 默认值  
	     * "sClass" : 相当于css中的text-align，有text-l、text-c、text-r（左中右）这三个选择
	     */
	    "aoColumns" : [		 
            {
			"mData" : "uid",
			"sTitle" : "ID", 
			"sDefaultContent" : "",  
            "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "真实性名", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "性别", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "职位", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "邮箱", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "联系方式", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "最后登录时间", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "状态", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    },
		    {
			"mData" : "uid",
			"sTitle" : "操作", 
			"sDefaultContent" : "",  
	        "sClass" : "text-c"
		    }
		    ],
		//aoColumnDefs用来设置列的属性，可以指定任何列，我们这里用来设置第一列[0]的复选框
		"aoColumnDefs":[{
                    "sClass": "text-c",
                    "mRender" : function(data,type,full) {
                        return '<input type="checkbox" id="chkId_' + data 
				     + '" name="chkId" value="' + data + '"  style="border:1px solid red"/>';
		    },
                    "bSortable": false,
                    "aTargets": [0]
        }], 
        //columnDefs和oColumnDefs差不多，它们的区别问百度吧    
        "columnDefs": [{ "orderable": false, "targets": 1 }],
        /**
         * fnServerData函数
         * 这个函数很重要，我们可以通过里面的参数类重构页面与服务器的交互方式
         * 总之，里面的ajax由我们配置，大家可以打印参数和回调测试测试
         */
	"fnServerData" : function(sSource, aoData, fnCallback) {
            $.ajax({
                type : 'POST',
                url : sSource,
                contentType: 'application/json',
                async : false,
                data : {
                    "aoData" : JSON.stringify(aoData)
                },
                success : fnCallback,
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.status + "," + textStatus);
                }
            });
        },
        /**
         * 大家试想一下这样一个业务场景，我们数据库中存放了性别这一列，数据库中的值
         * 1代表男；0代表女；假设我们没有在php中处理，那么页面显示的时候就会显示1或者是0
         * 这显然是不友好的。
         * fnRowCallback就可以直接在页面完美的解决这场景
         * 说白了，就是获取完行数据以后，我们在页面显示之前，对数据预处理下
         * 例子中只是增加操作列的查看、修改和删除图标与事件
         */
        "fnRowCallback" : function(nRow, aData, iDisplayIndex) { 
			var cstr = "<a title='查看' href='javascript:void(0);' onclick='notice_edit("+aData.id+",0)' class='ml-5' style='text-decoration:none'><i class='Hui-iconfont'></i></a>" +
        			   "<a title='编辑' href='javascript:void(0);' onclick='notice_edit("+aData.id+",1)' class='ml-5' style='text-decoration:none'><i class='Hui-iconfont'></i></a>" +
        			   "<a title='删除' href='javascript:void(0);' onclick='notice_del(this,"+ aData.id +")' class='ml-5' style='text-decoration:none'><i class='Hui-iconfont'></i></a>";
       	
        	$('td:eq(4)', nRow).html(cstr);
        	
            return nRow;
       }
	});	
	
	
	//注册查询按钮事件
	$("#search").bind("click", function () {
        //这里可以做一些js的格式验证
        table.fnDraw();//每次查询，调用fnDraw重绘
    });
});

function search() {
	var name = $("#s-username").val(); 
	var gender = $("#s-gender").val(); 
	var position = $("#s-position").val(); 
    $.ajax({
        type: "POST",
        url: "/user/searchAllUser",
        data: {"name":name,"gender":gender,"roleName":position},
        contentType: "application/json",
        success: function (result) {
        	   alert(result);
        	   layer.msg('修改成功!', {icon:1,time:1000}, function(){
                   var index = layer.getFrameIndex(window.name);
                   location.reload(); //刷新父页面
                   layer.close(index);
               });
       }, 
        error: function (XMLHttpRequest, textStatus, errorThrown) {
        	 layer.msg('error!',{icon:1,time:1000});   
       }
});
}
/*用户-添加*/
function member_add(title,url,w,h){
	layer_show(title,url,w,h);
}
/*用户-查看*/
function member_show(title,url,id,w,h){
	layer_show(title,url,w,h);
}
/*用户-停用*/
function member_stop(obj,id){
	layer.confirm('确认要停用吗？',function(index){
		$.ajax({
			type: 'POST',
			url: '',
			dataType: 'json',
			success: function(data){
				$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="member_start(this,id)" href="javascript:;" title="启用"><i class="Hui-iconfont">&#xe6e1;</i></a>');
				$(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已停用</span>');
				$(obj).remove();
				layer.msg('已停用!',{icon: 5,time:1000});
			},
			error:function(data) {
				console.log(data.msg);
			},
		});		
	});
}

/*用户-启用*/
function member_start(obj,id){
	layer.confirm('确认要启用吗？',function(index){
		$.ajax({
			type: 'POST',
			url: '',
			dataType: 'json',
			success: function(data){
				$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="member_stop(this,id)" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a>');
				$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
				$(obj).remove();
				layer.msg('已启用!',{icon: 6,time:1000});
			},
			error:function(data) {
				console.log(data.msg);
			},
		});
	});
}
/*用户-编辑*/
function member_edit(title,url,id,w,h){
	layer_show(title,url,w,h);
}
/*密码-修改*/
function change_password(title,url,id,w,h){
	layer_show(title,url,w,h);	
}
/*用户-删除*/
function member_del(obj,id){
	layer.confirm('确认要删除吗？',function(index){
		$.ajax({
			type: 'POST',
			url: '',
			dataType: 'json',
			success: function(data){
				$(obj).parents("tr").remove();
				layer.msg('已删除!',{icon:1,time:1000});
			},
			error:function(data) {
				console.log(data.msg);
			},
		});		
	});
}
</script> 
</body>
</html>